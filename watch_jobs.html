<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Watch Jobs Organizer</title>
  <!-- allow pinch-zoom and panning -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, minimum-scale=0.25, user-scalable=yes">
  <style>
    html,body { height:100%; margin:0; padding:0; font-family: Arial, sans-serif; background:#f5f5f5; }
    h2 { text-align:center; margin:12px 0; }
    .controls { display:flex; gap:10px; padding:0 12px 12px; align-items:center; }
    button { padding:8px 12px; font-size:1rem; cursor:pointer; }

    /* Entire canvas: scroll & zoom together */
    .board {
      display:flex;
      flex-direction:column;       /* categories stacked top-to-bottom */
      gap:30px;
      padding:12px;
      /* width set to accommodate wide job cards; you can pan/zoom to see everything */
      width: max-content;
      min-width: 100%;
      box-sizing: border-box;
      overflow:auto;               /* allow pan both directions */
      -webkit-overflow-scrolling: touch;
    }

    /* Category container (fixed in place) */
    .category {
      display:flex;
      flex-direction:column;
      background:#fff;
      border:1px solid #ccc;
      border-radius:6px;
      padding:12px;
      box-sizing:border-box;
      /* wide enough to hold full job card row */
      min-width: 900px;
      max-width: 1600px;
    }

    /* Title left aligned and placed above the date field area */
    .category h3 {
      margin:0 0 10px 6px;        /* small left offset so title sits above date */
      text-align:left;
      font-size:1rem;
      user-select: none;          /* prevent accidental selection while dragging */
      pointer-events: none;       /* prevents it being a drag target */
    }

    /* Jobs laid out horizontally across the category */
    .job {
      display:flex;
      align-items:center;
      gap:1px;
      margin:3px 0;
      padding:3px;
      background:#e6f3ff;
      border:1px solid #b3d1ff;
      border-radius:6px;
      box-shadow:1px 1px 6px rgba(0,0,0,0.12);
      cursor:grab;
      white-space:nowrap;         /* keep fields inline */
      box-sizing:border-box;
      /* job fills the category width so its fields are visible in a single row */
      width:100%;
      min-width: 800px;
      flex-shrink:0;
      -webkit-user-drag: none;
    }

    /* Small visual separation and clarity */
    .job .delete { color:#c00; cursor:pointer; margin-right:4px; flex-shrink:0; }
    .job input, .job select { font-size:0.9rem; padding:6px; box-sizing:border-box; }
    .work-display { font-size:0.85rem; font-weight:700; color:#222; margin-left:4px; }

    /* make form controls more touch-friendly on phones */
    input[type="text"], input[type="number"], select { min-height:36px; }

    /* Responsive tweak: reduce minimums a little on small screens but still keep one-line layout */
    @media (max-width:520px) {
      .category { min-width:700px; }
      .job { min-width:700px; }
    }
  </style>
</head>
<body>
  <h2>Watch Jobs Organizer</h2>
  <div class="controls">
    <button id="addBtn">+ Add Job</button>
    <button id="resetBtn" title="Clear all saved jobs on this device">Reset saved data</button>
    <div style="font-size:0.95rem;color:#444;">Data saved locally on this device (browser localStorage)</div>
  </div>

  <div class="board" id="board" tabindex="0"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
  <script>
    // CONFIG
    const categories = ["Ready","For Polishing","In Polishing","Waiting Parts","Testing","Sent"];
    const brands = ["Rolex","Omega","Patek Philippe","Audemars Piguet","Jaeger-LeCoultre","TAG Heuer","Breitling","IWC","Cartier","Longines"];
    const works = ["Service","Polish","Crystal","Parts","Dial Restore","Crown repair","Partial Job"];
    const clients = ["Kirsty","Arkin","Louise"];

    // DOM
    const board = document.getElementById('board');
    const addBtn = document.getElementById('addBtn');
    const resetBtn = document.getElementById('resetBtn');

    // Save/load
    function saveJobs(){
      const data = {};
      categories.forEach(cat=>{
        const el = document.getElementById(cat);
        data[cat] = [];
        el.querySelectorAll('.job').forEach(job=>{
          data[cat].push({
            date: job.querySelector('.date').value,
            brand: job.querySelector('.brand').value,
            reference: job.querySelector('.reference').value,
            customer: job.querySelector('.customer').value,
            client: job.querySelector('.client').value,
            work: Array.from(job.querySelector('.work').selectedOptions).map(o=>o.value),
            price: job.querySelector('.price').value
          });
        });
      });
      localStorage.setItem('watchJobs', JSON.stringify(data));
    }

    function loadJobs(){
      const raw = localStorage.getItem('watchJobs');
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        categories.forEach(cat=>{
          if(data[cat]) data[cat].forEach(job=> addJob(cat, job));
        });
      }catch(e){
        console.error('Failed to parse saved jobs', e);
      }
    }

    // helper: show selected work values
    function updateWorkDisplay(job){
      const display = job.querySelector('.work-display');
      const selected = Array.from(job.querySelector('.work').selectedOptions).map(o=>o.value).join(', ');
      display.textContent = selected;
    }

    // create job card element
    function createJobElement(jobData = {}){
      const job = document.createElement('div');
      job.className = 'job';
      job.innerHTML = `
        <span class="delete" onclick="deleteJob(this)">❌</span>
        <input type="text" class="date" value="${jobData.date || new Date().toLocaleDateString()}" readonly>
        <select class="brand">
          <option value="">Brand</option>
          ${brands.map(b=>`<option value="${b}" ${jobData.brand===b?'selected':''}>${b}</option>`).join('')}
        </select>
        <input type="text" class="reference" maxlength="10" placeholder="Reference" value="${jobData.reference||''}">
        <input type="text" class="customer" placeholder="Customer Name" value="${jobData.customer||''}">
        <select class="client">
          <option value="" ${!jobData.client?'selected':''}>Client</option>
          ${clients.map(c=>`<option value="${c}" ${jobData.client===c?'selected':''}>${c}</option>`).join('')}
        </select>
        <select class="work" multiple>
          ${works.map(w=>`<option value="${w}" ${jobData.work && jobData.work.includes(w)?'selected':''}>${w}</option>`).join('')}
        </select>
        <div class="work-display"></div>
        <input type="number" class="price" placeholder="Price (£)" value="${jobData.price||''}" max="1000">
      `;

      // update display and save on changes
      const workSelect = job.querySelector('.work');
      workSelect.addEventListener('change', ()=>{ updateWorkDisplay(job); saveJobs(); });
      updateWorkDisplay(job);

      job.querySelectorAll('input,select').forEach(el=>{
        if(el.classList.contains('work')) return;
        el.addEventListener('change', saveJobs);
      });

      return job;
    }

    // add job to category
    function addJob(cat='Ready', jobData={}){
      const catEl = document.getElementById(cat);
      const job = createJobElement(jobData);
      catEl.appendChild(job);
      saveJobs();
      // ensure newly added job is draggable by Sortable (it is by default)
    }

    // delete job with confirmation
    function deleteJob(btn){
      if(!confirm('Are you sure you want to delete this job?')) return;
      const job = btn.closest('.job');
      if(job) job.remove();
      saveJobs();
    }

    // Build categories (titles fixed; cannot be dragged)
    categories.forEach(cat=>{
      const catEl = document.createElement('div');
      catEl.className = 'category';
      catEl.id = cat;
      // title intentionally left-aligned and non-interactive (pointer-events:none on the title)
      catEl.innerHTML = `<h3>${cat}</h3>`;
      board.appendChild(catEl);

      // Make only .job elements draggable between categories.
      // 'draggable' option restricts which children can be dragged.
      Sortable.create(catEl, {
        group: 'shared',
        animation: 150,
        draggable: '.job',     // only elements matching .job are draggable
        handle: undefined,     // entire job is draggable (not the header), but header isn't a job
        onAdd: saveJobs,
        onUpdate: saveJobs,
        onRemove: saveJobs
      });
    });

    // Controls
    addBtn.addEventListener('click', ()=> addJob('Ready', {}));
    resetBtn.addEventListener('click', ()=>{
      if(!confirm('This will clear all saved jobs from this device. Continue?')) return;
      localStorage.removeItem('watchJobs');
      // remove all existing job elements from categories
      categories.forEach(cat=>{
        const el = document.getElementById(cat);
        el.querySelectorAll('.job').forEach(j=>j.remove());
      });
      alert('Saved jobs cleared. You can now add fresh jobs.');
    });

    // load existing saved jobs
    loadJobs();

    // Accessibility: allow keyboard focus on board and arrow keys to pan
    board.addEventListener('keydown', (e)=>{
      const step = 100;
      if(e.key === 'ArrowLeft') board.scrollLeft -= step;
      if(e.key === 'ArrowRight') board.scrollLeft += step;
      if(e.key === 'ArrowUp') board.scrollTop -= step;
      if(e.key === 'ArrowDown') board.scrollTop += step;
    });
  </script>
</body>
</html>
